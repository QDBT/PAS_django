{% load static %}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}My Application{% endblock %}</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <script src="https://kit.fontawesome.com/9cd06d1369.js" crossorigin="anonymous"></script>
</head>
<body>
    <div class="AllContainer1">
        <div class="AllContainer2">
            <div class="AllContainer3">
                <div class="AllContainer4">
                    <header class="topbar">
                        <div class="topbar-left">
                            <button id="SideBarButton" class="btn btn-primary mr-2">
                                <i class="fa-solid fa-bars"></i>
                            </button>
                            <div class="logo mr-2" id="logo">
                                <a href="{% url 'home' username %}">
                                    <img src="{% static 'images/Logo.jpg' %}" height="30px" width="80px">
                                </a>
                            </div>
                            <div class="project-title">
                                <h1 class="h5">{{ project.title }}</h1> <!-- Smaller title size -->
                            </div>
                        </div>
                        <div class="topbar-middle">
                            <button id="Debug" class="btn btn-success mb-4">
                                <i class="fa-solid fa-play"></i>
                                <span>Run</span>
                            </button>
                            <select id="main-file-select" class="form-select ml-2">
                                
                            </select>
                        </div>
                        <div class="topbar-right">
                            <button class="topbar-rightUser">                                
                            </button>
                        </div>
                        <input type="hidden" id="current-snippet-id" value=""> <!--To store the snippet ID-->
                    </header>
                    <div class="SidebarAndMain-container" >
                        <div class="SideBarContainer-1">
                            <div class="SideBarContainer-2">
                                <div class="SideBarContainer-3">
                                    <div class="SideBarSearch-1">
                                        <div class="SideBarSearch-2">
                                            <div class="SideBarSearch-3">
                                                <div class="SideBarSearch-4">
                                                    <div class="SideBarSearch-5">
                                                        <div class="SideBarSearch-6">
                                                            <input type="text" placeholder="Search" id="Search" class="SideBarSearch-Input">
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="SideBarFilesHistory">
                                        <div class="resizer" style="position: relative; transition: height 120ms ease-out; height: 492px;">
                                            <div class="SideBarFilesOptions">
                                                <button class="SideBarFilesOptionsLeft">
                                                    <i class="fa-solid fa-angle-down Icon"></i>
                                                    <div class="ButtonExplain">
                                                        <span class="ButtonExplainSpan">Files</span>
                                                    </div>
                                                </button>
                                                <div class="SideBarFilesOptionsRight">
                                                    <button class="OptionButton" id="SideBarNewFile">
                                                        <i class="fa-solid fa-file-circle-plus Icon"></i>
                                                    </button>
                                                    <button class="OptionButton">
                                                        <i class="fa-solid fa-folder-plus Icon" style="color: #FFD43B;"></i>
                                                    </button>
                                                    <button class="OptionButton">
                                                        <i class="fa-solid fa-ellipsis-vertical Icon"></i>
                                                    </button>
                                                </div>
                                            </div>
                                            <div class="SideBarFilesIndex1">
                                                <div class="SideBarFilesIndex2">
                                                    <div class="SideBarFilesIndex3">
                                                        <div class="SideBarFilesIndex4">
                                                            <div class="SideBarFilesIndex5">
                                                                <div role="tree" class="SideBarFilesIndex6">
                                                                   
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="SideBarFilesHistoryDivider1">
                                                <div class="SideBarFilesHistoryDivider2"></div>
                                            </div>
                                        </div>
                                        <div class="resizer" style="position: relative;
                                        transition: height 120ms ease-out;
                                        height: 340px;"></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="divider" dividerPosition="SidebarVsMain">
                            <div class="blanket"></div>
                            <div class="grip"></div>
                        </div>
                        <main id="main-content" class="MainContainer">
                            {% block content %}{% endblock %}
                        </main>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <script>
    
//----------------------------------------------------------------
    //  libraries
    function createUserIcon(Parent){
        // Use the server-rendered username
    const user = "{{ project.user }}";

    // Extract the first two letters of the user's name
    const userName = user || "";
    const initials = userName.slice(0, 2).toUpperCase();

    // Find the parent element by its class name
    const parent = document.querySelector(`${Parent}`);
    if (!parent) {
        console.error(`Parent element with class "${Parent}" not found.`);
        return;
    }

    // Create the UserAvatarIcon structure
    const userAvatarIcon1 = document.createElement('div');
    userAvatarIcon1.className = 'UserAvatarIcon1';
    userAvatarIcon1.style.setProperty('--size', '24px');
    userAvatarIcon1.style.setProperty('--ring-size', '1px');
    userAvatarIcon1.style.setProperty('--ring-color', 'var(--outline-dimmer, #3C445C)');
    userAvatarIcon1.style.setProperty('--has-on-click-shadow', 'inset 0 0 0 var(--ring-size) var(--ring-color)');
    userAvatarIcon1.style.setProperty('--border-radius', 'var(--border-radius-round)');

    const userAvatarIcon2 = document.createElement('div');
    userAvatarIcon2.className = 'UserAvatarIcon2';
    
    const userAvatarName = document.createElement('div');
    userAvatarName.className = 'UserAvatarIconName';
    userAvatarName.textContent = initials;
    

    // Build the structure
    userAvatarIcon2.appendChild(userAvatarName);
    userAvatarIcon1.appendChild(userAvatarIcon2);
    parent.appendChild(userAvatarIcon1);
    }

    function compareDividers(div1, div2) {
        // Collect differences
        const differences = [];

        // Check attributes (for simplicity, we only check 'data-transformx' here, but you can add more attributes)
        const attributes = ['data-transformx'];
        attributes.forEach(attr => {
            const val1 = div1.getAttribute(attr);
            const val2 = div2.getAttribute(attr);
            if (val1 !== val2) {
                differences.push(`Difference in attribute '${attr}': ${val1} vs ${val2}`);
            }
        });

        // Check class names
        if (div1.className !== div2.className) {
            differences.push(`Difference in class names: '${div1.className}' vs '${div2.className}'`);
        }

        // Check CSS custom properties
        const cssProperties = ['--transformX', '--height', '--width'];
        cssProperties.forEach(cssProp => {
            const val1 = getComputedStyle(div1).getPropertyValue(cssProp);
            const val2 = getComputedStyle(div2).getPropertyValue(cssProp);
            if (val1 !== val2) {
                differences.push(`Difference in CSS variable '${cssProp}': ${val1} vs ${val2}`);
            }
        });

        // Check bounding box positions (top, left, width, height)
        const rect1 = div1.getBoundingClientRect();
        const rect2 = div2.getBoundingClientRect();
        if (rect1.left !== rect2.left || rect1.top !== rect2.top || rect1.width !== rect2.width || rect1.height !== rect2.height) {
            differences.push(`Difference in position: left=${rect1.left}, top=${rect1.top}, width=${rect1.width}, height=${rect1.height} vs left=${rect2.left}, top=${rect2.top}, width=${rect2.width}, height=${rect2.height}`);
        }

        // Check inner HTML content
        if (div1.innerHTML !== div2.innerHTML) {
            differences.push('Difference in inner HTML content');
        }

        // Output all differences or confirm equality
        if (differences.length > 0) {
            //console.log('Differences found:', differences);
            return false;
        } else {
           // console.log('No differences found between the two dividers.');
            return true;
        }
    };
    
    
    </script>


   
    <!-- Bootstrap JS and dependencies -->
    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.5.2/dist/umd/popper.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>

    <!--CodeMirror Style Sheet-->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.58.3/codemirror.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.58.3/theme/dracula.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.58.3/codemirror.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.58.3/mode/python/python.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.58.3/addon/edit/matchbrackets.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.58.3/addon/edit/closebrackets.min.js"></script>

    <!--Interact.js for Drag and Resize-->
    <script src="https://cdn.jsdelivr.net/npm/interactjs@1.10.11/dist/interact.min.js"></script>

    <script>
        // setup global
        let FileData=[];

        document.addEventListener("DOMContentLoaded", function() {
//-----------------------------------------------------------------------------------------------
            // Create Structure
            function createTabPanel(data) {
                // Create the main `tabpanel` container
                const tabPanel = document.createElement('div');
                tabPanel.setAttribute('role', 'tabpanel');
                tabPanel.classList.add('panelAll1');
                tabPanel.setAttribute('panelPosition', 'Top-Left');
                tabPanel.setAttribute('id', data.id);
                tabPanel.addEventListener('click', event =>{
                    WhichPanelPositionIsChoosen = tabPanel.getAttribute('panelPosition')
                })

                // Create the second container
                const panelAll2 = document.createElement('div');
                panelAll2.classList.add('panelAll2');
                tabPanel.appendChild(panelAll2);

                // Add the resizer
                const resizer = document.createElement('div');
                resizer.setAttribute('tabindex', '-1');
                resizer.classList.add('resizer');
                panelAll2.appendChild(resizer);

                // Create the panelCode container
                const panelCode = document.createElement('div');
                panelCode.classList.add('panelCode');
                panelAll2.appendChild(panelCode);

                // Add the panelName container
                const panelName = document.createElement('div');
                panelName.classList.add('panelName');
                panelCode.appendChild(panelName);

                // Add the panelNameLeft
                const panelNameLeft = document.createElement('div');
                panelNameLeft.classList.add('panelNameLeft');
                panelName.appendChild(panelNameLeft);

                const panelNameLeft1 = document.createElement('div');
                panelNameLeft1.classList.add('panelNameLeft1');
                panelNameLeft.appendChild(panelNameLeft1);

                const nameButton = document.createElement('button');
                nameButton.classList.add('panelNameButton');
                panelNameLeft1.appendChild(nameButton);

                const iconImg = document.createElement('img');
                iconImg.classList.add('Icon');
                iconImg.src =  '{% static "images/Python.jpg" %}';
                nameButton.appendChild(iconImg);

                const panelNameWord = document.createElement('div');
                panelNameWord.classList.add('panelNameWord');
                panelNameWord.textContent = data.Language || 'Python';
                nameButton.appendChild(panelNameWord);

                // Add the panelNameRight
                const panelNameRight = document.createElement('div');
                panelNameRight.classList.add('panelNameRight');
                panelName.appendChild(panelNameRight);

                const panelNameRight1 = document.createElement('div');
                panelNameRight1.classList.add('panelNameRight1');
                panelNameRight.appendChild(panelNameRight1);

                const formatButton = document.createElement('button');
                formatButton.classList.add('panelFormatButton');
                panelNameRight1.appendChild(formatButton);

                const formatIcon = document.createElement('img');
                formatIcon.classList.add('Icon');
                formatButton.appendChild(formatIcon);

                const formatWord = document.createElement('div');
                formatWord.classList.add('panelFormatWord');
                formatButton.appendChild(formatWord);

                // Create the panelContent container
                const panelContent = document.createElement('div');
                panelContent.classList.add('panelContent');
                panelCode.appendChild(panelContent);

                const panelContent1 = document.createElement('div');
                panelContent1.classList.add('panelContent1');
                panelContent.appendChild(panelContent1);

                const panelContent2 = document.createElement('div');
                panelContent2.classList.add('panelContent2');
                panelContent1.appendChild(panelContent2);

                const panelContentEditor = document.createElement('div');
                panelContentEditor.classList.add('panelContentEditor');
                panelContent2.appendChild(panelContentEditor);

                const textarea = document.createElement('textarea');
                textarea.name = 'code';
                textarea.rows = '30';
                textarea.innerHTML = data.Code
                panelContentEditor.appendChild(textarea);

                // Create the panelBottom section
                const panelBottomParent =document.createElement('div');
                panelBottomParent.style.setProperty('display','block');
                panelCode.appendChild(panelBottomParent);

                const panelBottom = document.createElement('div');
                panelBottom.classList.add('panelBottom');
                panelBottomParent.appendChild(panelBottom);

                // Button 1: AI
                const resizerAI = document.createElement('div');
                resizerAI.classList.add('resizer');
                panelBottom.appendChild(resizerAI);

                const buttonAI = document.createElement('button');
                buttonAI.type = 'button';
                buttonAI.classList.add('panelBottomButton');
                resizerAI.appendChild(buttonAI);

                const iconAI = document.createElement('i');
                iconAI.classList.add('fa-solid', 'fa-brain', 'Icon');
                iconAI.style.color = '#cf73e8';
                buttonAI.appendChild(iconAI);

                const labelAI = document.createElement('div');
                labelAI.classList.add('resizer');
                labelAI.textContent = 'AI';
                buttonAI.appendChild(labelAI);

                // Button 2: Python
                const resizerPython = document.createElement('div');
                resizerPython.classList.add('resizer');
                panelBottom.appendChild(resizerPython);

                const buttonPython = document.createElement('button');
                buttonPython.type = 'button';
                buttonPython.classList.add('panelBottomButton');
                resizerPython.appendChild(buttonPython);

                const iconPython = document.createElement('i');
                iconPython.classList.add('fa-solid', 'fa-check', 'Icon');
                iconPython.style.color = '#0dd92f';
                buttonPython.appendChild(iconPython);

                const labelPython = document.createElement('div');
                labelPython.classList.add('resizer');
                labelPython.textContent = 'Python';
                buttonPython.appendChild(labelPython);

                // Button 3: Disabled
                const resizerDisabled = document.createElement('div');
                resizerDisabled.classList.add('resizer');
                panelBottom.appendChild(resizerDisabled);

                const buttonDisabled = document.createElement('button');
                buttonDisabled.type = 'button';
                buttonDisabled.classList.add('panelBottomButton');
                buttonDisabled.disabled = true;
                resizerDisabled.appendChild(buttonDisabled);

                // Blank Spacer
                const blankbrick = document.createElement('div');
                blankbrick.classList.add('blankbrick');
                panelBottom.appendChild(blankbrick);

                // Button 4: Line and Column
                const resizerLnCol = document.createElement('div');
                resizerLnCol.classList.add('resizer');
                panelBottom.appendChild(resizerLnCol);

                const buttonLnCol = document.createElement('button');
                buttonLnCol.type = 'button';
                buttonLnCol.classList.add('panelBottomButton');
                resizerLnCol.appendChild(buttonLnCol);

                const labelLnCol = document.createElement('span');
                labelLnCol.textContent = 'ln,col';
                buttonLnCol.appendChild(labelLnCol);

                Main = document.querySelector('main');
                Main.appendChild(tabPanel);
                
                CodeMirrorStyle(textarea,data);//Set Up Style for Coding Area with CodeMirror
                UpdatePanelPosition();

                console.log('Created tabPanel');
            }
            createUserIcon(".topbar-rightUser")//createUserIcon(ParentClassName) To know where to create
            
//-----------------------------------------------------------------------------------------------
            //Initial CSS style
            const root = document.getElement;
            let MainContainerAreaData = null;
            let panelPositionData=null;
            let snippetBarEachPositionData = null;
            let DividerEachPositionData = null;

            //Initial Css style for OptionButtonIcon
            const OptionButtonIcon = document.querySelectorAll(".OptionButton");
            let IconWidth =24;
            let IconHeight =24;
            OptionButtonIcon.forEach(icon => {
                icon.style.setProperty('--width', `${IconWidth}px`);
                icon.style.setProperty('--height', `${IconHeight}px`);
            });

            //Initial Css style for Topbar
            const TopbarData = {
                Height:50,
            };
            const Topbar=document.querySelector(".topbar");
            Topbar.style.setProperty('height', `${TopbarData.Height}px`);

            //Initial Css style for SidebarAndMain
            const SidebarAndMainData = {
                Top : TopbarData.Height,
                get Height(){ 
                    return window.innerHeight - this.Top;
                }
            }
            
            const SidebarAndMain = document.querySelector('.SidebarAndMain-container');
            function UpdateSidebarAndMainStyle(){
                SidebarAndMain.style.setProperty('--top', `${SidebarAndMainData.Top}px`);
                SidebarAndMain.style.setProperty('--height', `${SidebarAndMainData.Height}px`);
            }

            UpdateSidebarAndMainStyle();
            
            //Initial CSS style for sidebar
            const SidebarData ={
                get RightDivider(){
                    if (DividerEachPositionData != null){
                        return DividerEachPositionData.find(divider => divider.Position === "SidebarVsMain");
                    }
                    else {
                        return {TransformX: 0}
                    }
                },
                WidthInit :250,
                CurrentWidth:250,
                MinWidth:30,
                get Width() {
                    if (this.isClosed){
                        console.log("sidebar closed");
                        CurrentWidth = this.RightDivider.TransformX
                        this.RightDivider.TransformX = 0   
                    }
                    else{
                        this.RightDivider.TransformX = this.CurrentWidth
                    }
                    return this.RightDivider.TransformX;
                },
                isClosed: false,
                

            }
            //Sidebar open/close
            document.getElementById('SideBarButton').addEventListener('click', function() {
                if (!SidebarData.isClosed) {
                    //Collapse sidebar
                    SidebarData.isClosed=true;

                } else{
                    //Expand sidebar        
                    SidebarData.isClosed=false;                    
                }
                console.log(SidebarData);
                UpdateAllPosition();// set the width
            });
            
            const sidebar = document.querySelector('.SideBarContainer-1');

            function UpdateSidebarPosition(){
                sidebar.style.setProperty('--width', `${SidebarData.Width}px`);
            };
            UpdateSidebarPosition();

            MainContainerAreaData ={
                get LeftDivider(){ 
                    if (DividerEachPositionData != null){
                        return DividerEachPositionData.find(divider => divider.Position === 'SidebarVsMain')
                    }
                    else {
                        return {Width:0,TransformX:0};
                    }
                },
                get TransformX(){
                    return this.LeftDivider.TransformX + this.LeftDivider.Width 
                },
                get Width(){
                    return window.innerWidth - this.TransformX;
                },
                TransformY: SidebarAndMainData.Top,
                Height: SidebarAndMainData.Height,
            }

             //Initial CSS style for Each divider
            DividerEachPositionData=[
                {
                    Position:'SidebarVsMain',
                    ControlType:'vertical',
                    get Height(){
                        return SidebarAndMainData.Height;
                    },
                    Width:6,
                    gripWidth:2,
                    gripHeight:20,
                    gripColor : '#2B3245',
                    gripColorHover:'#e2d8d87f',
                    cursor:'col-resize',
                    backgroundColor:'#0E1525',
                    backgroundColorMove:'#4689b8',
                    CurrentDivider:null,
                    isDragging:false,
                    startX:0,
                    currentX:0,
                    InitialTransformX:0,
                    TransformX:SidebarData.WidthInit,//Change this
                    startY:0,
                    currentY:0,
                    InitialTransformY:0,
                    TransformY:0,
                },
                {
                    Position:'MiddleVsBottom',
                    ControlType:'horizontal',
                    Height:6,
                    get Width(){
                        return MainContainerAreaData.Width;
                    },
                    gripWidth:20,
                    gripHeight:2,
                    gripColor : '#2B3245',
                    gripColorHover:'#e2d8d87f',
                    cursor:'row-resize',
                    backgroundColor:'#0E1525',
                    backgroundColorMove:'#4689b8',
                    CurrentDivider:null,
                    isDragging:false,
                    startX:0,
                    currentX:0,
                    InitialTransformX:0,
                    get TransformX(){
                        return MainContainerAreaData.TransformX;
                    },
                    startY:0,
                    currentY:0,
                    InitialTransformY:0,
                    TransformY:MainContainerAreaData.Height*2/3,//change this
                },
                {
                    Position:'Top-LeftVsTop-Right',
                    ControlType:'vertical',
                    get BottomDivider() {
                        return DividerEachPositionData.find(divider => divider.Position === 'MiddleVsBottom') ?? { Height: 0, TransformY: 0 };                  
                    },
                    get Height(){
                        return this.BottomDivider.TransformY - MainContainerAreaData.TransformY
                    },
                    Width:6,
                    gripWidth:2,
                    gripHeight:20,
                    gripColor : '#2B3245',
                    gripColorHover:'#e2d8d87f',
                    cursor:'col-resize',
                    backgroundColor:'#0E1525',
                    backgroundColorMove:'#4689b8',
                    CurrentDivider:null,
                    isDragging:false,
                    startX:0,
                    currentX:0,
                    InitialTransformX:0,
                    TransformX: MainContainerAreaData.Width/2, // Change this
                    startY:0,
                    currentY:0,
                    InitialTransformY:0,
                    TransformY:0
                }
            ]
            
            
            const dividers=document.querySelectorAll(".divider");//Select all the divider elements
            function UpdateDividerPosition(){
                //Initial each divider with its own --transformX Variable
                dividers.forEach(divider=>{
                    const Position = divider.getAttribute('dividerPosition');
                    DividerEachPositionData.forEach(item=>{ 
                        if (item.Position == Position){
                            divider.style.setProperty('--height',`${item.Height}px`);
                            divider.style.setProperty('--width',`${item.Width}px`);
                            divider.style.setProperty('--gripWidth',`${item.gripWidth}px`);
                            divider.style.setProperty('--gripHeight',`${item.gripHeight}px`);
                            divider.addEventListener('mouseenter',function(){
                                divider.style.setProperty('--gripColor',`${item.gripColorHover}`)
                            });
                            divider.addEventListener('mouseleave',function(){
                                divider.style.setProperty('--gripColor',`${item.gripColor}`)
                            });
                            divider.style.setProperty('--cursor',`${item.cursor}`);
                            divider.style.setProperty('--transformX', `${item.TransformX}px`);//--transformX Value is the same with sidebarWidth
                            divider.style.setProperty('--transformY', `${item.TransformY}px`);
                            if (item.isDragging==true){
                                divider.style.setProperty('--background-color', `${item.backgroundColorMove}`);
                            }
                            else {
                                divider.style.setProperty('--background-color', `${item.backgroundColor}`);
                            }
                        }
                    });
                });
            }
            UpdateDividerPosition();

            //Initial style for allsnippetBar
            const snippetBarAllPostionData ={
                Height : 32,
                Scale:1,
                TransitionDuration:0,
            }
            //Set up the data for snippetBar Position.The Position change as Top, Left, Width
            snippetBarEachPositionData = [
                { 
                    Position:'Top-Left', 
                    get RightDivider(){
                        return DividerEachPositionData.find(divider => divider.Position === 'Top-LeftVsTop-Right');
                    },
                    get Top(){ 
                        return 0
                    },
                    get Left(){
                        return MainContainerAreaData.TransformX
                    },
                    get Width(){
                        if (this.RightDivider){
                            return this.RightDivider.TransformX - this.Left
                        }
                        else {
                            return MainContainerAreaData.Width
                        }
                    },
                    Height:snippetBarAllPostionData.Height,
                    Scale:snippetBarAllPostionData.Scale,
                    TransitionDuration:snippetBarAllPostionData.TransitionDuration,
                  },
                { 
                    Position:'Bottom', 
                    get TopDivider(){
                        return DividerEachPositionData.find(divider => divider.Position === 'MiddleVsBottom');
                    },
                    get Top(){ 
                        return this.TopDivider.TransformY + this.TopDivider.Height;
                    },
                    get Left(){
                        return MainContainerAreaData.TransformX
                    },
                    get Width(){
                        return MainContainerAreaData.Width
                    },
                    Height:snippetBarAllPostionData.Height,
                    Scale:snippetBarAllPostionData.Scale,
                    TransitionDuration:snippetBarAllPostionData.TransitionDuration,
                },
                { 
                    Position:'Top-Right', 
                    get LeftDivider() {
                        return DividerEachPositionData.find(divider => divider.Position === 'Top-LeftVsTop-Right');
                    },
                    get BottomDivider(){
                        return DividerEachPositionData.find(divider => divider.Position === 'MiddleVsBottom');
                    },
                    get Top(){ 
                        return 0;
                    },
                    get Left(){
                        return this.LeftDivider.TransformX + this.LeftDivider.Width 
                    },
                    get Width(){
                        return window.innerWidth - this.Left 
                    },
                    Height:snippetBarAllPostionData.Height,
                    Scale:snippetBarAllPostionData.Scale,
                    TransitionDuration:snippetBarAllPostionData.TransitionDuration,
                },
                
            ]
                  
            const snippetBars=document.querySelectorAll('.snippetBar');

            //function for updating snippetBar of each Position
            function UpdateSnippetBarPosition(){
                snippetBars.forEach((snippetBar,index) =>{
                    const Position = snippetBar.getAttribute('panelPosition');
                    snippetBarEachPositionData.forEach(item => {
                        if (item.Position === Position) {
                            snippetBar.style.setProperty('--left', `${item.Left}px`);
                            snippetBar.style.setProperty('--top', `${item.Top}px`);
                            snippetBar.style.setProperty('--width', `${item.Width}px`);
                            snippetBar.style.setProperty('--height', `${item.Height}px`);
                            snippetBar.style.setProperty('--scale',`${item.Scale}`);
                            snippetBar.style.setProperty('--transitionDuration', `${item.TransitionDuration}ms`);
                        }
                    });
                });
            };
            
            //Initial style for each snippetBar of each Position
            UpdateSnippetBarPosition();
            
            //Initial style for allpanel                        
            //Set up the data for snippetBar Position.The Position change as TransformX,TransformY, Width,Height
            panelPositionData =[
                { 
                    Position:'Top-Left',
                    get OwnSnippetBar(){
                        return snippetBarEachPositionData.find(snippet => snippet.Position === this.Position);
                    },
                    get LeftDivider(){
                        return DividerEachPositionData.find(divider => divider.Position === 'SidebarVsMain');
                    },
                    get BottomDivider(){
                        return DividerEachPositionData.find(divider => divider.Position === 'MiddleVsBottom') ?? {TransformX:0,TransformY:0,Height:0,Width:0};
                    },  
                    get Width(){ 
                        return this.OwnSnippetBar.Width;
                    },
                    get Height(){
                        return this.BottomDivider.TransformY - this.TransformY 
                    },
                    get TransformX(){
                        return this.OwnSnippetBar.Left;
                    },
                    get TransformY(){
                        return this.OwnSnippetBar.Top + this.OwnSnippetBar.Height
                    },
                    TransformScale:1,
                    TransitionDuration:0  
                },
                {
                    Position:'Bottom',
                    get OwnSnippetBar(){
                        return snippetBarEachPositionData.find(snippet => snippet.Position === this.Position);
                    },
                    get LeftDivider(){
                        return DividerEachPositionData.find(divider => divider.Position === 'SidebarVsMain');
                    },
                    get TopDivider(){
                        return DividerEachPositionData.find(divider => divider.Position === 'MiddleVsBottom');
                    },
                    get Width(){ 
                        return this.OwnSnippetBar.Width
                    },
                    get Height(){
                        return MainContainerAreaData.Height-this.TransformY
                    },
                    get TransformX(){
                        return this.OwnSnippetBar.Left;
                    },
                    get TransformY(){
                        return this.OwnSnippetBar.Top + this.OwnSnippetBar.Height
                    },
                    TransformScale:1,
                    TransitionDuration:0  
                },
                {
                    Position:'Top-Right',
                    get OwnSnippetBar(){
                        return snippetBarEachPositionData.find(snippet => snippet.Position === this.Position);
                    },
                    get LeftDivider(){
                        return DividerEachPositionData.find(divider => divider.Position === 'SidebarVsMain');
                    },
                    get BottomDivider(){
                        return DividerEachPositionData.find(divider => divider.Position === 'MiddleVsBottom');
                    },
                    get Width(){ 
                        return this.OwnSnippetBar.Width
                    },
                    get Height(){
                        return this.BottomDivider.TransformY - this.TransformY 
                    },
                    get TransformX(){
                        return this.OwnSnippetBar.Left;
                    },
                    get TransformY(){
                        return this.OwnSnippetBar.Top + this.OwnSnippetBar.Height
                    },
                    TransformScale:1,
                    TransitionDuration:0  
                },
            ]
            //function for updating snippetBar of each Position
            function UpdatePanelPosition(){
                const panels =document.querySelectorAll('.panelAll1');
                panels.forEach((panel,index)=>{
                    
                    const Position = panel.getAttribute('panelPosition');
                    panelPositionData.forEach((item,index) => {
                        if (item.Position === Position){
                        panel.style.setProperty('--width',`${item.Width}px`);
                        panel.style.setProperty('--height',`${item.Height}px`);
                        panel.style.setProperty('--transformX', `${item.TransformX}px`);
                        panel.style.setProperty('--transformY', `${item.TransformY}px`);
                        panel.style.setProperty('--scale', item.TransformScale);
                        panel.style.setProperty('--transitionDuration', `${item.Transitionduration}ms`);
                        console.log("setupPanel",item.Position);
                        }
                    });
                });
            }

            //Initial style for each panel with position
            UpdatePanelPosition();
            //Initial style for panel Bottom


            
            //Set the function to move divider
            dividers.forEach(divider=>{
                //Mousedown events to start dragging a specific divider
                divider.addEventListener('mousedown',function(e) {
                    const Position = divider.getAttribute('dividerPosition');
                    const Item = DividerEachPositionData.find(item => item.Position === Position);
                    
                    Item.isDragging = true;
                    Item.startX = e.clientX;
                    Item.InitialTransformX = Item.TransformX;
                    Item.startY = e.clientY;
                    Item.InitialTransformY = Item.TransformY;
                    
                    console.log('mousedown')
                });

                //Mouse move event to handle dragging
                document.addEventListener('mousemove', function(e) {
                    DividerEachPositionData.forEach(item => {
                        if (item.isDragging) {
                            if (item.ControlType ==='vertical') {
                                item.currentX = e.clientX - item.startX;
                                item.TransformX = item.InitialTransformX + item.currentX;
                                //console.log('Sidebar',SidebarData.Width,SidebarData.isClosed);
                                item.TransformX = item.TransformX < SidebarData.MinWidth ? 0 : item.TransformX;
                                
                                console.log(item.TransformX);


                                // Update the sidebar width and divider transformX
                                if (item.Position === 'SidebarVsMain'){
                                    console.log('SidebarChange');
                                    SidebarData.CurrentWidth = item.TransformX;
                                }
                            }
                            else if (item.ControlType ==='horizontal'){
                                item.currentY = e.clientY - item.startY;
                                item.TransformY = item.InitialTransformY + item.currentY;
                                
                                console.log(item.TransformY);
                            }
                            // Update other UI components based on the sidebarâ€™s new width
                            UpdatePanelPosition();
                            UpdateSidebarPosition();
                            UpdateDividerPosition();
                            UpdateSnippetBarPosition();
                        }
                    });
                });

                // Mouse up event to stop dragging 
                document.addEventListener('mouseup', function() {
                    DividerEachPositionData.forEach(item =>{
                        if (item.isDragging){
                            item.isDragging = false;
                            UpdateAllPosition();
                            console.log('mouseup')
                        }
                   })               
                });
            });

            function UpdateAllPosition(){
                UpdatePanelPosition();
                UpdateSidebarPosition();
                UpdateDividerPosition();
                UpdateSnippetBarPosition();
            };
            UpdateAllPosition();
            let WhichPanelPositionIsChoosen = "Top-Left"; //Init that Top-Left 
            const AllsnippetBar = document.querySelectorAll('.snippetBar'); // Will Remove this after done create structure  
            AllsnippetBar.forEach(snippetBar =>{
                snippetBar.addEventListener('click',event =>{
                    WhichPanelPositionIsChoosen = snippetBar.getAttribute('panelPosition');
                    console.log(WhichPanelPositionIsChoosen)
                })
            })
    

//-----------------------------------------------------------------------------------------------
            //Create new file
            //In Sidebar---------------------------------------------------
            FileData = [
                {% for snippet in snippets %}
                    {
                        FileName: `{{ snippet.file_name|escapejs}}`,
                        Language: "{{snippet.language}}",  // Default language
                        Code: `{{ snippet.code|escapejs }}`,
                    }{% if not forloop.last %},{% endif %}
                {% endfor %}                
            ];//FileData is all files
              //First time update from server
            //Create a unique ID for EachFile
            FileData.forEach((file) => {
                file.id = `${Date.now()}-${Math.random().toString(36).substring(2, 9)}`;
            });

            //MainFileData is the File would be debug, the rest of this is SubFile
            let MainFileData = FileData[0];

            //Create The Option that which file will be debuged

            function CreateTopBarSelectMainFileOption(file){
                //find parent
                parent = document.querySelector('#main-file-select');

                // Create the option
                const option = document.createElement('option');
                option.value = file.FileName;
                option.textContent = file.FileName;

                parent.appendChild(option);
                // Add an event listener to the <select> to handle selection changes
                parent.addEventListener('change', (event) => {
                    const selectedFileName = event.target.value; // Get selected option's value
                    if (selectedFileName === file.FileName) {
                        MainFileData = file; // Set MainFileData
                        console.log('Main file updated:', file); // Log the new main file
                        console.log(FileData)
                    }
                });
            }
            FileData.forEach((file) => CreateTopBarSelectMainFileOption(file));
            
            
            //Update First time
            function CreateSidebarTree(data,index){
                console.log(data);
                const SideBarTreeContainer = document.querySelector('.SideBarFilesIndex6');
                const rowHeight = 24;
                const rowY = 8 + rowHeight * index;

                const treeItem = document.createElement('div');
                treeItem.setAttribute('role', 'treeitem');
                treeItem.setAttribute('id',data.id);
                treeItem.className = 'SideBarFilesTreeItems';
                treeItem.style.setProperty('--rowHeight', `${rowHeight}px`);
                treeItem.style.setProperty('--rowY', `${rowY}px`);
                treeItem.addEventListener('click',(event)=>{
                    UserChooseThisFile(data);
                })

                // Create the inner structure
                const treeItemInner = document.createElement('div');
                treeItemInner.title = data.FileName;
                treeItemInner.className = 'SideBarFilesTreeItems1';

                // Create the file icon container
                const iconContainer = document.createElement('div');
                iconContainer.className = 'SideBarFilesIcon';

                // Add the image to the icon container
                const iconImage = document.createElement('img');
                iconImage.className = 'Icon';
                iconImage.src = "{% static 'images/Python.jpg' %}"; // Adjust this for file type icons
                iconContainer.appendChild(iconImage);

                // Add the file name
                const fileNameDiv = document.createElement('div');
                fileNameDiv.className = 'SideBarFilesName';
                fileNameDiv.setAttribute('data-filename', data.FileName); // For duplicate checks
                fileNameDiv.textContent = data.FileName;

                // Append the icon container and file name to the inner div
                treeItemInner.appendChild(iconContainer);
                treeItemInner.appendChild(fileNameDiv);

                // Create the menu button
                const menuButton = document.createElement('button');
                menuButton.title = 'menu';
                menuButton.className = 'SideBarFilesMenuButton';

                // Add the menu button icon
                const menuIcon = document.createElement('img');
                menuIcon.className = 'Icon';
                menuButton.appendChild(menuIcon);

                // Append the inner div and menu button to the tree item
                treeItem.appendChild(treeItemInner);
                treeItem.appendChild(menuButton);

                // Append the tree item to the container
                SideBarTreeContainer.appendChild(treeItem);
                CreateSnippetsBarUnit(data);

            }
            FileData.forEach(function(data,index){
                CreateSidebarTree(data,index)
            })
            function UpdateFileData(name,language=null,code=null){
                id = `${Date.now()}-${Math.random().toString(36).substring(2, 9)}`;//create id for each
                FileData.push(
                    {
                        FileName:name,
                        Language:language,
                        Code:code,
                        id:id,
                    }
                )
                
            }

            const SideBarNewFile = document.getElementById('SideBarNewFile')
            SideBarNewFile.addEventListener('click', function(){
                const SideBarTreeContainer = document.querySelector('.SideBarFilesIndex6');

                const rowHeight = 24;
                const rowY = 8 + rowHeight * FileData.length;
                // Create an input field for the new file name
                const inputField = document.createElement('input');
                inputField.type = 'text';
                inputField.setAttribute('role', 'treeitem');
                inputField.className = 'SideBarFilesTreeItems';
                inputField.placeholder = 'Enter file name (e.g., NewFile.py)';
                inputField.style.setProperty('--rowHeight', `${rowHeight}px`);
                inputField.style.setProperty('--rowY', `${rowY}px`);

                // Append the input field to the sidebar
                SideBarTreeContainer.appendChild(inputField);
                inputField.focus();

                // Handle input confirmation (when user presses Enter or blurs the input)
                let isHandled = false;

                const handleConfirm = () => {
                    if (isHandled) return; // Ensure the handler runs only once
                    isHandled = true;

                    const fileName = inputField.value.trim();

                    // Validate file name
                    if (!fileName) {
                        alert('File name cannot be empty!');
                        inputField.remove();
                        return;
                    }
                    if (document.querySelector(`.SideBarFilesName[data-filename="${fileName}"]`)) {
                        alert('A file with this name already exists!');
                        inputField.remove();
                        return;
                    }
                    
                    // Determine file title and language
                    let language = ""; // Default language

                    // Extract the part after the last '.' in the filename
                    const parts = fileName.split('.');
                    if (parts.length > 1) {
                        language = parts.pop().toLowerCase(); // Get the extension and convert to lowercase
                    } else {
                        language = ""; // Default if no '.' in the filename
                    }

                    // Validate the extracted language
                    const allowedLanguages = ["py", "js", "c", "css"]; // Add more valid extensions as needed
                    if (!allowedLanguages.includes(language)) {
                        language = ""; // Set to default if not allowed
                    }
                    // Remove input field
                    inputField.remove();

                    // Create the new file tree item
                    UpdateFileData(fileName, language, "");
                    console.log(FileData)
                    CreateSidebarTree(FileData[FileData.length-1],FileData.length-1);
                    CreateTopBarSelectMainFileOption(FileData[FileData.length-1]);

                    //For Update Style
                    UserChooseThisFile(FileData[FileData.length-1]);
                };

                // Confirm on blur or Enter key
                inputField.addEventListener('blur', handleConfirm);
                inputField.addEventListener('keydown', (event) => {
                    if (event.key === 'Enter') {
                        handleConfirm();
                    }
                });
            })

            //In SnippetsBar----------------------------------------------------

            function CreateSnippetsBarUnit(data) {
                //Find Parent 
                const  snippetBar = document.querySelectorAll('.snippetBar');
                const snippetBarWithThisPosition = Array.from(snippetBar).find(item => 
                    item.getAttribute('panelPosition') === WhichPanelPositionIsChoosen
                );
                const parent = snippetBarWithThisPosition.querySelector('.snippetBarLeftName2')
                // Create this child
                const snippetBarUnit = document.createElement('div');
                snippetBarUnit.className = 'snippetBarUnit';
                snippetBarUnit.setAttribute('id',data.id);
                snippetBarUnit.addEventListener('click', event => {
                    UserChooseThisFile(data);                    
                });
                //snippetBarUnit1 Container
                const snippetBarUnit1 = document.createElement('div');
                snippetBarUnit1.className = 'snippetBarUnit1';

                // Resizer container
                const resizer = document.createElement('span');
                resizer.className = 'resizer';

                // Snippet bar button
                const snippetBarButton = document.createElement('button');
                snippetBarButton.className = 'snippetBarButton';
                

                // Snippet bar button content
                const snippetBarButtonContent = document.createElement('div');
                snippetBarButtonContent.className = 'snippetBarButton1';

                // Icon inside snippet button
                const snippetIcon = document.createElement('img');
                snippetIcon.className = 'Icon';
                snippetIcon.src = "{% static 'images/Python.jpg' %}"; // Adjust dynamically based on data if needed

                // Append icon to button content
                snippetBarButtonContent.appendChild(snippetIcon);

                // Snippet name container
                const snippetNameContainer = document.createElement('div');
                snippetNameContainer.className = 'snippetBarUnitButtonName';

                // Snippet name
                const snippetName = document.createElement('span');
                snippetName.className = 'snippetBarUnitButtonName1';
                snippetName.textContent = `${data.FileName}`; // Use the file name from `data`

                // Append snippet name to its container
                snippetNameContainer.appendChild(snippetName);

                // Append content and name to snippet button
                snippetBarButton.appendChild(snippetBarButtonContent);
                snippetBarButton.appendChild(snippetNameContainer);

                // Append button to resizer
                resizer.appendChild(snippetBarButton);

                // Close button container
                const closeButtonContainer = document.createElement('div');
                closeButtonContainer.className = 'snippetBarCloseButton';

                // Option button
                const optionButton = document.createElement('button');
                optionButton.className = 'OptionButton';
                // Add the close button functionality
                optionButton.addEventListener('click', event => {
                    event.stopPropagation(); // Prevent triggering parent click events
                    
                    snippetBarUnit.remove(); // Remove the snippetBarUnit from the DOM
                    
                    //find the tab panel and remove it
                    let AllPanel = document.querySelectorAll(`[role=tabpanel]`);
                    let panel = Array.from(AllPanel).find(item => 
                        item.getAttribute('panelposition') === WhichPanelPositionIsChoosen &&
                        item.getAttribute('id') === data.id,                   
                    );
                    if (panel) {
                        panel.remove();
                    }

                    //If this was the Chosen Panel, change the another one exits in snippetBar
                    const x = FileData.findIndex(file => file.id === data.id);
                    
                    if (x != FileData.length - 1) {
                        return -1;        
                    }
                    
                    UserChooseThisFile(FileData[FindTheLastUnitStillAvailable(x)]);
                    console.log(FileData)
                    function FindTheLastUnitStillAvailable(x) {
                        if (x < 0) {
                            return -1; // Return an invalid index or handle as needed
                        }

                        const snippetBar = document.querySelectorAll('.snippetBar');
                        const snippetBarWithThisPosition = Array.from(snippetBar).find(item => 
                            item.getAttribute('panelPosition') === WhichPanelPositionIsChoosen
                        );

                        if (!snippetBarWithThisPosition) {
                            console.error("No snippet bar found for the given position.");
                            return -1; // Return an invalid index or handle as needed
                        }

                        const AllUnit = snippetBarWithThisPosition.querySelectorAll('.snippetBarUnit');
                        const unit = Array.from(AllUnit).find(item => 
                            item.getAttribute('id') === FileData[x]?.id // Handle potential undefined FileData[x]
                        );

                        if (!unit) {
                            return FindTheLastUnitStillAvailable(x - 1); // Recursively check previous units
                        } else {
                            return x; // Return the valid index
                        }
                    }
                });

                // Option button inner structure
                const optionButtonInner = document.createElement('div');
                optionButtonInner.className = 'OptionButton1';

                const optionButtonInner2 = document.createElement('div');
                optionButtonInner2.className = 'OptionButton2';

                // Append inner structure to option button
                optionButtonInner.appendChild(optionButtonInner2);

                // Close button icon
                const closeButtonIcon = document.createElement('div');
                closeButtonIcon.className = 'snippetBarCloseButtonIcon';

                const closeIcon = document.createElement('i');
                closeIcon.className = 'fa-solid fa-xmark Icon';

                // Append close icon to container
                closeButtonIcon.appendChild(closeIcon);
                optionButton.appendChild(optionButtonInner);
                optionButton.appendChild(closeButtonIcon);

                // Append option button to close button container
                closeButtonContainer.appendChild(optionButton);

                // Append resizer and close button to parent container
                snippetBarUnit1.appendChild(resizer);
                snippetBarUnit1.appendChild(closeButtonContainer);
                
                snippetBarUnit.appendChild(snippetBarUnit1);

                
                parent.appendChild(snippetBarUnit);

                createTabPanel(data);
            }
            
//-----------------------------------------------------------------------------------------------
            function CodeMirrorStyle(element,filedata){
                var Textarea = CodeMirror.fromTextArea(element, {
                    lineNumbers: true,
                    mode: "python",  // Change to your desired language
                    matchBrackets: true,
                    autoCloseBrackets: true,
                    theme: "dracula"  // Set the theme to dracula for a dark background
                })
                // Enable real-time resizing
                Textarea.on("change", function() {
                    element.value = Textarea.getValue();
                    filedata.Code=element.value;// auto changed file data code if typing
                });
    
                window.addEventListener('resize', function() {
                    Textarea.setSize("100%","100%");
                    UpdateAllPosition();
                });
                

                Textarea.setSize("100%","100%");
            }
            function UserChooseThisFile(data){
                function UpdateSideBarTree(data){
                    //find all Sidebar Unit
                    const AllSideBarTree=document.querySelectorAll('[role=treeitem]');

                    //Update Unchosen SidebarUnit
                    AllSideBarTree.forEach((AnotherSideBarUnit)=>{
                        UpdateStyleForUnchosenSidebarUnit(AnotherSideBarUnit)
                    })
                    
                    //Find Chosen Sidebar Unit
                    const ActiveSideBarUnit = Array.from(AllSideBarTree).find(item => item.id === data.id);
                    
                    //Update Chosen Sidebar Unit
                    UpdateStyleForChosenSidebarUnit(ActiveSideBarUnit);

                    //Style Css
                    function UpdateStyleForChosenSidebarUnit(ActiveSideBarUnit){
                        ActiveSideBarUnit.style.setProperty("--nodeBackgroundColor","#c2c8cc39");
                    }
                    function UpdateStyleForUnchosenSidebarUnit(AnotherSideBarUnit){
                        AnotherSideBarUnit.style.setProperty("--nodeBackgroundColor","#transparent");
                    }
                }
                function UpdateSnippetBarUnit(data){
                    //find the parent
                    const snippetBar=document.querySelectorAll('.snippetBar');
                    const snippetBarWithThisPosition = Array.from(snippetBar).find(item => 
                        item.getAttribute('panelPosition') === WhichPanelPositionIsChoosen
                    );

                    //Update Unchoosen Unit
                    let AllsnippetBarUnit = snippetBarWithThisPosition.querySelectorAll('.snippetBarUnit')
                    
                    AllsnippetBarUnit.forEach(AnotherUnit =>{
                        UpdateStyleForUnchosenSnippetUnit(AnotherUnit)
                    })

                    //Update Choosen Unit
                    //Find it if it exists in this snippetBar 
                    ActiveSnippetBarUnit=Array.from(AllsnippetBarUnit).find(item => item.id === data.id);
                    
                    //If not exits, create a new Unit and find it again
                    if (!ActiveSnippetBarUnit){
                        CreateSnippetsBarUnit(data);
                        return UpdateSnippetBarUnit(data);
                    }
                    //else if exists update Css for easy to know which is chosen
                    else {
                        AllsnippetBarUnit.forEach(AnotherUnit =>{
                            UpdateStyleForUnchosenSnippetUnit(AnotherUnit);
                            AnotherUnit.setAttribute('isChosen', 'false');
                        })
                        UpdateStyleForChosenSnippetUnit(ActiveSnippetBarUnit)
                        ActiveSnippetBarUnit.setAttribute('isChosen', 'true');
                    } 
                    
                    //---------------------------------------------------------------
                    //Style Css
                    function UpdateStyleForChosenSnippetUnit(ActiveSnippetBarUnit){
                        ActiveSnippetBarUnit.style.setProperty('background-color','#c2c8cc39');
                        ActiveSnippetBarUnit.style.setProperty('border-top','3px solid #ff00f7');
                    }
                    function UpdateStyleForUnchosenSnippetUnit(AnotherUnit){
                        AnotherUnit.style.setProperty('background-color','');
                        AnotherUnit.style.setProperty('border-top','');
                    }
                }
                function UpdateTabPanel(data){
                    //set up Index
                    const ActiveZIndex = 5;
                    const InActiveZIndex = 3;

                    //find the parent
                    const AlltabPanel = document.querySelectorAll(`[role=tabpanel]`);

                    //Find all Panel in same position
                    const AlltabPanelWithThisPosition = Array.from(AlltabPanel).filter(panel => 
                        panel.getAttribute('panelPosition') === WhichPanelPositionIsChoosen
                    );

                    //find the ActivePanel and Update Chosen Panel
                    let ActiveTabPanel = Array.from(AlltabPanelWithThisPosition).find(item => item.id === data.id);

                    //If it exists, only update Css for Show visible
                    if (ActiveTabPanel){
                        //Update All Panel  
                        AlltabPanelWithThisPosition.forEach(AnotherPanel =>{
                            UpdateStyleForUnchosenPanel(AnotherPanel)
                        })
                        //Update Chosen Panel
                        UpdateStyleForChosenPanel(ActiveTabPanel);
                    } 
                    else {
                        console.error('Unable to find active panel');
                    }
                    
                    //-----------------------------------------------------------------
                    //Style CSS
                    function UpdateStyleForChosenPanel(ActiveTabPanel){
                        ActiveTabPanel.style.setProperty("z-index",ActiveZIndex);
                        ActiveTabPanel.style.setProperty("opacity",1);
                        ActiveTabPanel.style.setProperty("visibility",'visible');
                    }
                    function UpdateStyleForUnchosenPanel(AnotherPanel){
                        AnotherPanel.style.setProperty("z-index",InActiveZIndex);
                        AnotherPanel.style.setProperty("opacity",0);
                        AnotherPanel.style.setProperty("visibility",'hidden');
                    }
                }
                
                //Update the Order
                function UpdateUserChooseFileInOrder(data) {
                    const x = FileData.findIndex(file => file.id === data.id);
                    if (x == FileData.length - 1) {
                        return -1
                    }
                    if (x !== -1) {
                        // Remove the element at index `x`
                        const [element] = FileData.splice(x, 1);
                        // Add it to the end of the array
                        FileData.push(element);
                    }
                }

                if(data){
                    UpdateUserChooseFileInOrder(data);
                    UpdateSnippetBarUnit(data);
                    UpdateTabPanel(data);         
                    UpdateSideBarTree(data);
                }
            }
//----------------------------------------------------------------
            //Output

            let OutputDataHistory = [];
            const maxEntries = 10;
            const OneLineHeight = 20;
            
            function formatElapsedTime(milliseconds) {
                const minutes = Math.floor(milliseconds / 60000);
                const hours = Math.floor(minutes / 60);
                const days = Math.floor(hours / 24);

                if (days > 0) {
                    return `${days} day${days > 1 ? 's' : ''} ago`;
                } else if (hours > 0) {
                    return `${hours} hour${hours > 1 ? 's' : ''} ago`;
                } else {
                    return `${minutes} minute${minutes > 1 ? 's' : ''} ago`;
                }
            }

            function createBaseStructure(HistoryData) {
                //Record the Time Started
                data =HistoryData.Data;
                duration =HistoryData.DebugDuration;
                created_at =HistoryData.When;
                const WhenStarted = Date.now();
                
                // Main container
                
                const resizer = document.createElement('div');
                resizer.classList.add('resizer');

                // Panel header
                const panelOutputContentHeader = document.createElement('div');
                panelOutputContentHeader.classList.add('panelOutputContentHeader');
                //The Header Background will follow status
                panelOutputContentHeader.style.setProperty('--background-color',`${HistoryData.Status ? '#1c331c' : '#331c1c'}`);
                resizer.appendChild(panelOutputContentHeader);

                // Left side of header
                const headerLeft = document.createElement('div');
                headerLeft.classList.add('panelOutputContentHeaderLeft');
                panelOutputContentHeader.appendChild(headerLeft);

                const collapseButton = document.createElement('button');
                collapseButton.type = 'button';
                collapseButton.classList.add('OptionButton');
                collapseButton.style.setProperty('--height','24px');
                collapseButton.style.setProperty('--width','24px');
                collapseButton.setAttribute('aria-label', 'Collapse');
                collapseButton.innerHTML = '<i class="fa-solid fa-angle-down Icon"></i>';
                headerLeft.appendChild(collapseButton);

                const runContainer = document.createElement('div');
                runContainer.classList.add('panelOutputContentHeaderLeftRun');
                runContainer.innerHTML = '<span>Run</span>';
                headerLeft.appendChild(runContainer);

                const collapsedText = document.createElement('div');
                collapsedText.classList.add('panelOutputContentHeaderTextIfCollapsed');
                headerLeft.appendChild(collapsedText);

                // Right side of header
                const headerRight = document.createElement('div');
                headerRight.classList.add('panelOutputContentHeaderRight');
                panelOutputContentHeader.appendChild(headerRight);

                // Ask AI button
                const askAIContainer = document.createElement('div');
                askAIContainer.classList.add('panelOutputContentHeaderRightAskAI');
                headerRight.appendChild(askAIContainer);

                const askAIButton = document.createElement('button');
                askAIButton.type = 'button';
                askAIButton.classList.add('panelOutputContentHeaderRightAskAIButton');
                askAIButton.innerHTML = `<div class="SpanAndIconInsideButton">
                                            <i class="fa-solid fa-headset Icon"></i>
                                            <span class="SpanAndIconInsideButtonSpan">Ask AI</span>
                                        </div>`;
                askAIContainer.appendChild(askAIButton);

                // Attach event listener to the Ask AI button
                askAIButton.addEventListener("click", function() {
                    // Assuming we want to use 'only_code' as the feedback option when this button is clicked
                    AskAIDirectlyFromOutPut(created_at);
                });

                const askAIRiver = document.createElement('div');
                askAIRiver.classList.add('panelOutputContentHeaderRiver');
                askAIContainer.appendChild(askAIRiver);

                // Time and duration
                const timeContainer = document.createElement('div');
                timeContainer.classList.add('panelOutputContentHeaderRightTime');
                headerRight.appendChild(timeContainer);
                
                

                const timeSpan = document.createElement('span');
                timeSpan.classList.add('panelOutputContentHeaderRightTime1');
                timeSpan.innerHTML = `${duration}ms &nbsp;ãƒ» &nbsp;<span class="panelOutputContentHeaderRightTime2">Just now</span>`;
                timeContainer.appendChild(timeSpan);

                const TimeAgo = setInterval(() => {
                    const elapsedTime = Date.now() - WhenStarted;
                    const formattedTime = formatElapsedTime(elapsedTime);

                    // Update the inner HTML of timeSpan
                    timeSpan.innerHTML = `${duration}ms &nbsp;ãƒ» &nbsp;<span class="panelOutputContentHeaderRightTime2">${formattedTime}</span>`;
                }, 60000); // Updates every minute

                const timeRiver = document.createElement('div');
                timeRiver.classList.add('panelOutputContentHeaderRiver');
                timeContainer.appendChild(timeRiver);

                // Status icon section
                const statusContainer = document.createElement('div');
                statusContainer.classList.add('panelOutputContentHeaderRightStatus');
                const statusIcon = document.createElement('span');
                statusIcon.classList.add('resizer');
                statusIcon.innerHTML = `<i class="fa-solid ${HistoryData.Status ? 'fa-check' : 'fa-triangle-exclamation'} Icon"></i>`;
                statusContainer.appendChild(statusIcon);
                headerRight.appendChild(statusContainer);

                // Terminal output
                const terminalContainer = document.createElement('div');
                terminalContainer.classList.add('panelOutputContentBlock1');
                terminalContainer.style.position = 'sticky';
                terminalContainer.style.top = '28px';
                const newlineCount = (data.match(/\n/g) || []).length+1;
                console.log("Number of newline characters:", newlineCount);
                const BlockMinHeight = Math.max(50, newlineCount * OneLineHeight);
                terminalContainer.style.setProperty('--BlockMinHeight',`${BlockMinHeight}px`);
                resizer.appendChild(terminalContainer);

                const terminalBlock = document.createElement('div');
                terminalBlock.classList.add('panelOutputContentBlock2');
                terminalContainer.appendChild(terminalBlock);

                const outputContentBlock3 = document.createElement('div');
                outputContentBlock3.classList.add('panelOutputContentBlock3');
                terminalBlock.appendChild(outputContentBlock3);

                const terminal = document.createElement('div');
                terminal.classList.add('terminal', 'xterm');
                outputContentBlock3.appendChild(terminal);

                const xtermViewport = document.createElement('div');
                xtermViewport.classList.add('xterm-viewport');
                xtermViewport.style.backgroundColor = 'rgb(28, 35, 51)';
                terminal.appendChild(xtermViewport);

                const xtermScreen = document.createElement('div');
                xtermScreen.classList.add('xterm-screen');
                xtermScreen.style.width = '100%';
                xtermScreen.style.height = `100%`;

                const outputContainer = document.createElement('div');
                outputContainer.classList.add('output');
                outputContainer.innerHTML = data.replace(/ /g, '&nbsp;').replace(/\n/g, '<br>');
                xtermScreen.appendChild(outputContainer);
                terminal.appendChild(xtermScreen);

                

                const panelOutputContentRiver = document.createElement('div');
                panelOutputContentRiver.classList.add('panelOutputContentRiver');
                resizer.appendChild(panelOutputContentRiver);

                const panelOutputContentEnd = document.createElement('div');
                panelOutputContentEnd.classList.add('panelOutputContentEnd');
                resizer.appendChild(panelOutputContentEnd);

                // Append the complete structure to the body or a specific container
                const ChildElement= document.querySelector(".panelOutputContent");
                ChildElement.appendChild(resizer);
            }


            //
            function addToOutputDataHistory(status, data, duration, created_at) {
                const debugEntry = {
                    Status: status,//status=true means Debug succeeded, false means Error
                    Data: data,//// Stores response data or error messages
                    DebugDuration: duration ,// Store duration in milliseconds
                    When: created_at,
                };
                if (OutputDataHistory.length >= maxEntries) {
                    OutputDataHistory.shift(); // Remove the oldest entry if max limit reached
                }
                OutputDataHistory.push(debugEntry);
                if (ShowOnlyToggleCheckbox.checked) { 
                    const panelOutputContent = document.querySelector('.panelOutputContent');
                    panelOutputContent.innerHTML = ''; // Clear the existing content
                }
                createBaseStructure(OutputDataHistory[OutputDataHistory.length-1]);
                console.log("Current OutputDataHistory:", OutputDataHistory); // Log for verification
                
            }

            // Update the elapsed time every minute
            

            document.getElementById('Debug').addEventListener('click', function() {
                const startTime = Date.now();
                const activeEditor = document.querySelector('.CodeMirror');   
                if (activeEditor) {
                    const textarea = activeEditor.CodeMirror.getTextArea();
                    textarea.value = activeEditor.CodeMirror.getValue(); // Ensure textarea value is updated
                    console.log("Act9ve",FileData);
                    const code = textarea.value;
                    const url = `/${'{{username}}'}/${'{{project.title}}'}/code_debug/`;
                    fetch(url, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'X-CSRFToken': '{{ csrf_token }}'
                        },
                        body: JSON.stringify({ FileData,MainFileData })
                    })
                    .then(response => {
                        if (!response.ok) {
                            console.log("data:",'{{data}}')
                            return response.text().then(text => { throw new Error(text) });
                        }
                        return response.json();
                    })
                    .then(data => {
                        const debugDuration = Date.now() - startTime;
                        console.log('Snippet saved successfully:', data);
                        
                        if (data.output){
                            addToOutputDataHistory(true, data.output,debugDuration,data.created_at);

                        }
                        else if (data.error){
                            addToOutputDataHistory(false, data.error,debugDuration,data.created_at);
                        }
                    })
                    .catch(error => {
                        console.error('Error:', error);
                        alert('An error occurred: ' + error.message);
                    });
                    
                } 
            });

            //Output Show History Toggle
            // Select the hidden checkbox and the SVG elements
            const ShowOnlyToggleCheckbox = document.querySelector(".panelOutputOptionShow2 input");
            const svgBackground = document.querySelector(".svgBackground");
            const svgKnob = document.querySelector(".svgKnob");

            // Function to update the SVG based on the checkbox state
            function updateToggleSwitch() {
            if (ShowOnlyToggleCheckbox.checked) {
                // When checked (ON state)
                svgBackground.setAttribute("fill", "#0079F2"); // Active background color
                svgKnob.setAttribute("x", "18"); // Move knob to the right
            } else {
                // When unchecked (OFF state)
                svgBackground.setAttribute("fill", "#3C445C"); // Inactive background color
                svgKnob.setAttribute("x", "4"); // Move knob to the left
            }
            }

            // Initialize the toggle appearance based on the initial state
            updateToggleSwitch();

            // Add a click event listener to the label to toggle the checkbox and update the SVG
            document.querySelector(".panelOutputOptionShow2").addEventListener("click", function () {
                const HTMLHistory= document.querySelector(".panelOutputContent");
                const LastestHistory=OutputDataHistory[OutputDataHistory.length-1]
                if (!ShowOnlyToggleCheckbox.checked) {
                    //When turn On
                    HTMLHistory.innerHTML =""; // Clear all the History on HTML
                    
                    createBaseStructure(LastestHistory)//Show the Lastest
                }
                else {
                    //When turn Off
                    HTMLHistory.innerHTML =""; // Clear all the History on HTML
                    OutputDataHistory.forEach(function(entry){
                        createBaseStructure(entry)
                    })//Show all the History
                }
                
                // Toggle the checkbox state
                ShowOnlyToggleCheckbox.checked = !ShowOnlyToggleCheckbox.checked;
                
                // Update the SVG appearance based on the new state
                updateToggleSwitch();

                // Optional: Log the current state or perform additional actions
                console.log(ShowOnlyToggleCheckbox.checked ? "Switch is ON" : "Switch is OFF");
            });    


            //Clear the History Button
            document.getElementById("clearHistoryButton").addEventListener("click", ClearHistory);
            function ClearHistory(){
                OutputDataHistory.length = 0; // Clear the history
                const panelOutputContent = document.querySelector('.panelOutputContent');
                if (panelOutputContent) {
                    panelOutputContent.innerHTML = '';
                }
            }
//----------------------------------------------------------------
            //Send Feedback inside output
            
//----------------------------------------------------------------    
            //FeedBack
            const panelAIStyle = document.querySelector('.panelAskAIMain');
            function updatePanelAIStyle(){
                panelAIStyle.style.setAttribute("--flexDirection","column");
                panelAIStyle.style.setProperty("--overflowY","auto");
                panelAIStyle.style.setProperty("--overflowX","hidden");
                panelAIStyle.style.setProperty("--buttonBottom","0");
                panelAIStyle.style.setProperty("--buttonTop","auto");
                panelAIStyle.style.setProperty("--buttonLeft","50%");
                panelAIStyle.style.setProperty("--buttonRight","auto");
                panelAIStyle.style.setProperty("--buttonBorderRadius","16px");
                panelAIStyle.style.setProperty("--buttonPx","6px");
                panelAIStyle.style.setProperty("--scrollBehavior","auto");
                panelAIStyle.style.setProperty("--scrollSnapType","none");
                panelAIStyle.style.setProperty("--padding","0");
                panelAIStyle.style.setProperty("--scrollHeight","28px");
            }

            var onlyCodeOption = document.getElementById("only-code");
            var withoutCodeOption = document.getElementById("without-code");
            var feedback = document.getElementById("feedback");
            
            //The Option will appear after debug
            //FeedBack will appear if the option been clicked
             // Handle the help option click
             document.getElementById('please-help').addEventListener('click', function() {
                document.getElementById('feedback-container').style.display = 'block';
                document.getElementById('help-option').style.display = 'none';
            });
            
            // Handle the do it myself click
            document.getElementById('do-it-myself').addEventListener('click', function() {
                document.getElementById('help-option').style.display = 'none';
            });
            
            

            function AskAIDirectlyFromOutPut(created_at){
                const url = `/${'{{username}}'}/${'{{project.title}}'}/feedback/`
                fetch(url, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-CSRFToken': '{{ csrf_token }}'
                    },
                    body: JSON.stringify({ 'created_at': created_at })
                })
                .then(response => {
                    if (!response.ok) {
                        return response.text().then(text => { throw new Error(text) });
                    }
                    return response.json();
                })
                .then(data=> {
                    console.log('Feedback option sent successfully:', data);
                    display=document.getElementById("feedback")
                    display.innerHTML = data.output
                })
                .catch(error => {
                    console.error('Error:', error);
                    alert('An error occurred: ' + error.message);
                });

            }
            // Function to send the selected feedback option to the backend
//------------------------------------------------------------------------------------------------
            //Last Settings
            UserChooseThisFile(MainFileData);
        });


        // Add beforeunload event listener
        //Save the changed file
        window.addEventListener('beforeunload', (event) => {
            // Show a confirmation dialog
            const message = "You have unsaved changes. Do you really want to leave?";
            event.preventDefault(); // Necessary for some browsers
            event.returnValue = message; // Show this message in the dialog

            // Send data to the backend using sendBeacon
            
            const url = `/${'{{username}}'}/${'{{project.title}}'}/save/`;
            fetch(url, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'X-CSRFToken': '{{ csrf_token }}'
                },
                body: JSON.stringify( FileData )
            }).catch((error) => console.error('Error sending data:', error));
        });

    </script>
<style>
    body {
        background-color: var(--background-root,#0E1525);
        font-family: var(--font-family-default);
        font-size: var(--font-size-default,14px);
        color: var(--foreground-default,#f5f9f5);
    }
    input{
        color:#f5f9f5;
    }
    *{
        scrollbar-color: var(--background-highest,#3C445C) var(--background-default,#1C2333);
        --border-radius-round: 1028px;
    }
    .AllContainer1{

    }
    .AllContainer2{
        width: 100%;
        position: relative;
        padding-top: 0px;
        min-height: 100vh;
    }
    .AllContainer3{
        min-height: 100vh;
        width: 100%;
        position: relative;
        background-color: var(--background-root,#0E1525);
        padding-top: 0px;
    }
    .AllContainer4 {
        -webkit-box-align: stretch;
        align-items: stretch;
        border-width: 0px;
        border-style: solid;
        box-sizing: border-box;
        display: flex;
        flex-basis: auto;
        flex-direction: column;
        flex-shrink: 0;
        outline: none;
        min-height: 0px;
        min-width: 0px;
        background-color: var(--background-root,#0E1525);
        --surface-background: var(--background-root,#0E1525);
        --interactive-background: var(--background-default,#1C2333);
        --interactive-background--active: var(--background-higher,#2B3245);
        --interactive-border: var(--outline-dimmest,#2B3245);
        --interactive-border--hover: var(--outline-default,#4E5569);
        position: fixed;
        top: 0px;
        left: 0px;
        height: 100%;
        width: 100%;
    }
/******************************** Top Bar ********************************/
    .topbar {
        position: absolute;
        display:grid;
        grid-template-columns: 1fr max-content 1fr;
        border-width: 0px;
        border-style: solid;
        box-sizing:border-box;
        flex-basis:auto;
        flex-direction: column;
        flex-shrink: 0;
        outline:none;
        min-height:0px;
        min-width: 0px;
        width:100%;
        top:0px;
        left:0px;
        background-color: #f8f9fa;
        padding: 8px 12px;
        border-bottom: 1px solid #dee2e6;
        align-items: center;
        -webkit-box-align:center;
        color:black;
    }

    .topbar-left {
        border-width: 0px;
        border-style:solid;
        box-sizing:border-box;
        flex-basis:auto;
        flex-shrink: 0;
        outline:none;
        min-height:0px;
        min-width:0px;
        display: flex;
        flex-direction: row;
        -webkit-box-align:center;
        align-items: center;
        -webkit-box-pack:start;
        justify-content: flex-start;
    }

    .topbar-middle {
        display:flex;
        border-width:0px;
        border-style:solid;
        box-sizing:border-box;
        flex-basis:auto;
        flex-shrink: 0;
        min-height:0px;
        min-width:0px;
        position:relative;
        flex-direction:row;
        gap:8px;
        align-items:center;
    }

    .topbar-right {
        display:flex;
        border-width:0px;
        border-style:solid;
        box-sizing:border-box;
        flex-basis:auto;
        flex-shrink: 0;
        min-height:0px;
        min-width:0px;
        flex-direction:row;
        gap:6px;
        align-items: center;
        justify-content: flex-end;
    }
    .topbar-rightUser {
        padding: 4px;
        box-sizing: border-box;
        display: flex;
        flex-basis: auto;
        flex-shrink: 0;
        outline: none;
        min-height: 0px;
        min-width: 0px;
        flex-direction: row;
        gap: 2px;
        -webkit-box-align: center;
        align-items: center;
        color: var(--foreground-default,#F5F9FC);
        cursor: pointer;
        transition-property: background-color, box-shadow;
        transition-duration: 120ms;
        transition-timing-function: ease-out;
        border-radius: 4px;
        background-color: transparent;
        border-width: 1px;
        border-style: solid;
        border-color: transparent;
        height: 32px;
    }
    .topbar-rightUser:hover {
        cursor:pointer;
    }
    .AvatarIcon{
        -webkit-box-align: stretch;
        align-items: stretch;
        border-width: 0px;
        border-style: solid;
        box-sizing: border-box;
        display: flex;
        flex-basis: auto;
        flex-direction: column;
        flex-shrink: 0;
        outline: none;
        min-height: 0px;
        min-width: 0px;
        position: relative;
    }
    .UserAvatarIcon1{
        -webkit-box-align: stretch;
        align-items: stretch;
        border-width: 0px;
        border-style: solid;
        box-sizing: border-box;
        display: flex;
        flex-basis: auto;
        flex-direction: column;
        flex-shrink: 0;
        outline: none;
        min-height: 0px;
        min-width: 0px;
        border-radius: var(--border-radius);
        overflow: hidden;
        width: var(--size,24px);
        height: var(--size,24px);
        background-color: var(--outline-dimmest,#2B3245);
        position: relative;
    }
    .UserAvatarIcon2{
        border-width: 0px;
        border-style: solid;
        box-sizing: border-box;
        display: flex;
        flex-basis: auto;
        flex-direction: column;
        flex-shrink: 0;
        outline: none;
        min-height: 0px;
        min-width: 0px;
        position: absolute;
        top: 0px;
        left: 0px;
        width: 100%;
        height: 100%;
        -webkit-box-align: center;
        align-items: center;
        -webkit-box-pack: center;
        justify-content: center;
    }
    .UserAvatarIconName{
        border-width: 0px;
        border-style: solid;
        box-sizing: border-box;
        display: flex;
        flex: 1 1 auto;
        flex-direction: column;
        outline: none;
        min-height: 0px;
        min-width: 0px;
        -webkit-box-flex: 1;
        -webkit-box-align: center;
        align-items: center;
        -webkit-box-pack: center;
        justify-content: center;
        color: var(--foreground-dimmest,#9DA2A6);
        font-size: calc(var(--size) / 2.5);
    }
    #Debug {
        display: block;
        margin: 20px auto;
        padding: 10px 20px;
        background-color: #046c00;
        color: #fff;
        border: none;
        cursor: pointer;
        width:100px;
    }

/******************************** Top Bar ********************************/

/******************************** SidebarAndMain ********************************/

    .SidebarAndMain-container {
        -webkit-box-align: stretch;
        align-items: stretch;
        border-width: 0px;
        border-style: solid;
        box-sizing: border-box;
        display: flex;
        flex-basis: auto;
        flex-direction: column;
        flex-shrink: 0;
        outline: none;
        min-height: 0px;
        min-width: 0px;
        width: 100%;
        left: 0px;
        position: absolute;
        height:var(--height);
        top:var(--top);
    }

/******************************** SideBar ********************************/

    #SideBarButton {
            margin-left: 10px; 
    }

    .SideBarContainer-1{
        -webkit-box-align: stretch;
        align-items: stretch;
        border-width: 0px;
        border-style: solid;
        box-sizing: border-box;
        flex: 1 1 auto;
        outline: none;
        min-height: 0px;
        min-width: 0px;
        height: 100%;
        position: absolute;
        top: 0px;
        left: 0px;
        display: flex;
        flex-direction: row;
        -webkit-box-flex: 1;
        overflow: auto;
        opacity: var(--opacity,1);
        pointer-events: var(--pointerEvents,auto);
        transition: opacity 0.2s 200ms;
        width: var(--width);
        visibility: var(--sidebarVisibility ,visible);
    }

    .SideBarContainer-2{
        -webkit-box-align: stretch;
        align-items: stretch;
        border-width: 0px;
        border-style: solid;
        box-sizing: border-box;
        display: flex;
        flex-basis: auto;
        flex-direction: column;
        flex-shrink: 0;
        outline: none;
        min-height: 0px;
        min-width: 0px;
        visibility: var(--mainContentVisibility,visible);
    }

    .SideBarContainer-3{
        -webkit-box-align: stretch;
        align-items: stretch;
        border-width: 0px;
        border-style: solid;
        box-sizing: border-box;
        display: flex;
        flex-basis: auto;
        flex-shrink: 0;
        outline: none;
        min-height: 0px;
        position: absolute;
        flex-direction: column;
        gap: var(--space-4);
        top: 0px;
        left: 0px;
        width: 100%;
        height: 100%;
        min-width: 180px;
        animation: 0.2s ease-in-out 0s 1 normal none running animation-5j8bii;
    }

    .SideBarSearch-1{
        -webkit-box-align: stretch;
        align-items: stretch;
        border-width: 0px;
        border-style: solid;
        box-sizing: border-box;
        display: flex;
        flex-basis: auto;
        flex-direction: column;
        flex-shrink: 0;
        outline: none;
        min-height: 0px;
        min-width: 0px;
        padding-left: 8px;
        z-index: 3;
    }

    .SideBarSearch-2{
        -webkit-box-align: stretch;
        align-items: stretch;
        border-width: 0px;
        border-style: solid;
        box-sizing: border-box;
        display: flex;
        flex-basis: auto;
        flex-direction: column;
        flex-shrink: 0;
        outline: none;
        min-height: 0px;
        min-width: 0px;
        top: 0px;
        left: 0px;
        width: 100%;
        z-index: 3;
    }
    .SideBarContainer-2 > div:first-of-type > div:first-of-type{
        padding-left: 0px;
        padding-right: 0px;
        padding-top: 0px;
    }

    .SideBarSearch-3{
        -webkit-box-align: stretch;
        align-items: stretch;
        border-width: 0px;
        border-style: solid;
        box-sizing: border-box;
        flex: 1 1 auto;
        outline: none;
        min-height: 0px;
        min-width: 0px;
        -webkit-box-flex: 1;
        width: 100%;
        height: 100%;
        display: flex;
        flex-direction: row;
        -webkit-box-pack: center;
        justify-content: center;
        border-radius: 4px;
        container-name: CommandBar;
        container-type: var(--containerType,normal);
    }

    .SideBarSearch-4{
        -webkit-box-align: stretch;
        align-items: stretch;
        border-width: 0px;
        border-style: solid;
        box-sizing: border-box;
        display: flex;
        flex: 1 1 auto;
        flex-direction: column;
        outline: none;
        min-height: 0px;
        min-width: 0px;
        -webkit-box-flex: 1;
        max-width: calc(600px - 16px);
        font-size: var(--fontSize,14px);
        max-width:100%;
    }

    .SideBarSearch-5{
        -webkit-box-align: stretch;
        align-items: stretch;
        border-width: 0px;
        border-style: solid;
        box-sizing: border-box;
        display: flex;
        flex-basis: auto;
        flex-direction: column;
        flex-shrink: 0;
        outline: none;
        min-height: 0px;
        min-width: 0px;
        padding-bottom: 0px;
        padding-top: var(--inputBarPadding,0px);
        padding-inline: var(--inputBarPadding,0px);
    }

    .SideBarSearch-6{
        transition-property: background-color, box-shadow;
        transition-duration: 120ms;
        transition-timing-function: ease-out;
        background-color: var(--interactive-background,#1C2333);
        border-color: transparent;
        border-width: 0px;
        border-style: solid;
        box-sizing: border-box;
        flex: 1 1 auto;
        outline: none;
        min-height: 0px;
        min-width: 0px;
        display: flex;
        flex-direction: row;
        -webkit-box-align: center;
        align-items: center;
        -webkit-box-flex: 1;
        height: 2.29em;
        border-radius: 0.29em;
    }
    .SideBarSearch-6:hover{
        cursor: pointer;
    }
    .SideBarSearch-Input{
        -webkit-box-align: stretch;
        align-items: stretch;
        box-sizing: border-box;
        display: flex;
        flex: 1 1 auto;
        flex-direction: column;
        min-height: 0px;
        min-width: 0px;
        -webkit-box-flex: 1;
        height: 100%;
        font-size: 1em;
        padding: 0px 0.57em;
        background-color: transparent;
        border: 0px none;
        outline: none 0px;
    }

    .SideBarFilesHistory{
        -webkit-box-align: stretch;
        align-items: stretch;
        border-width: 0px;
        border-style: solid;
        box-sizing: border-box;
        display: flex;
        flex: 1 1 auto;
        flex-direction: column;
        outline: none;
        min-height: 0px;
        min-width: 0px;
        -webkit-box-flex: 1;
    }

    .SideBarFilesOptions{
        border-width: 0px;
        border-style: solid;
        box-sizing: border-box;
        display: flex;
        flex-basis: auto;
        flex-shrink: 0;
        outline: none;
        min-height: 0px;
        min-width: 0px;
        flex-direction: row;
        gap: 4px;
        -webkit-box-align: center;
        align-items: center;
        height: 36px;
        user-select: none;
    }

    .SideBarFilesOptionsLeft{
        box-sizing: border-box;
        display: flex;
        flex: 1 1 auto;
        outline: none;
        min-height: 0px;
        min-width: 0px;
        border: none;
        background: transparent;
        color: inherit;
        font-style: inherit;
        font-variant: inherit;
        font-weight: inherit;
        font-stretch: inherit;
        font-size: inherit;
        font-family: inherit;
        font-optical-sizing: inherit;
        font-size-adjust: inherit;
        font-kerning: inherit;
        font-feature-settings: inherit;
        font-variation-settings: inherit;
        line-height: normal;
        app-region: no-drag;
        user-select: none;
        height: 100%;
        border-radius: 4px;
        margin-left: 8px;
        -webkit-box-flex: 1;
        flex-direction: row;
        gap: 4px;
        -webkit-box-align: center;
        align-items: center;
        cursor: pointer;
        position: relative;
    }

    .ButtonExplain{
        border-width: 0px;
        border-style: solid;
        box-sizing: border-box;
        display: flex;
        flex-basis: auto;
        flex-shrink: 0;
        outline: none;
        min-height: 0px;
        min-width: 0px;
        flex-direction: row;
        gap: 4px;
        -webkit-box-align: center;
        align-items: center;
    }

    .ButtonExplainSpan{
        -webkit-box-align: stretch;
    align-items: stretch;
    border-width: 0px;
    border-style: solid;
    box-sizing: border-box;
    flex-basis: auto;
    flex-direction: column;
    flex-shrink: 0;
    outline: none;
    min-height: 0px;
    min-width: 0px;
    display: inline;
    overflow-wrap: break-word;
    line-height: var(--lineHeight,1.6);
    color: var(--color);
    font-weight: var(--font-weight-medium,500);
    font-size: 13px;
    }

    .SideBarFilesOptionsRight{
        -webkit-box-align: stretch;
        align-items: stretch;
        border-width: 0px;
        border-style: solid;
        box-sizing: border-box;
        display: flex;
        flex-basis: auto;
        flex-shrink: 0;
        outline: none;
        min-height: 0px;
        min-width: 0px;
        flex-direction: row;
        gap: 4px;
        padding-right: 2px;
    }
    
    .SideBarFilesIndex1{
        -webkit-box-align: stretch;
        align-items: stretch;
        border-width: 0px;
        border-style: solid;
        box-sizing: border-box;
        display: flex;
        flex: 1 1 auto;
        flex-direction: column;
        outline: none;
        min-height: 0px;
        min-width: 0px;
        -webkit-box-flex: 1;
        overflow-y: auto;
        scrollbar-width: none;
        position: relative;
    }

    .SideBarFilesIndex2{
        -webkit-box-align: stretch;
        align-items: stretch;
        border-width: 0px;
        border-style: solid;
        box-sizing: border-box;
        display: flex;
        flex-basis: auto;
        flex-direction: column;
        flex-shrink: 0;
        outline: none;
        min-height: 0px;
        min-width: 0px;
        padding-bottom: 8px;
    }

    .SideBarFilesIndex3{
        -webkit-box-align: stretch;
        align-items: stretch;
        border-width: 0px;
        border-style: solid;
        box-sizing: border-box;
        display: flex;
        flex-basis: auto;
        flex-direction: column;
        flex-shrink: 0;
        outline: none;
        min-height: 0px;
        min-width: 0px;
        position: absolute;
        top: 0px;
        left: 0px;
        width: 100%;
        height: 100%;
    }

    .SideBarFilesIndex4{
        -webkit-box-align: stretch;
        align-items: stretch;
        border-width: 0px;
        border-style: solid;
        box-sizing: border-box;
        display: flex;
        flex-basis: auto;
        flex-direction: column;
        flex-shrink: 0;
        outline: none;
        min-height: 0px;
        min-width: 0px;
        position: absolute;
        top: 0px;
        left: 0px;
        width: 100%;
        height: 100%;
        padding-left:8px;
    }

    .SideBarFilesIndex5{
        -webkit-box-align: stretch;
        align-items: stretch;
        border-width: 0px;
        border-style: solid;
        box-sizing: border-box;
        display: flex;
        flex-basis: auto;
        flex-direction: column;
        flex-shrink: 0;
        outline: none;
        min-width: 0px;
        padding-left: 2px;
        padding-right: 2px;
        position: relative;
        overflow-y: auto;
        height: 100%;
        min-height: var(--minHeight,24px);
    }

    .SideBarFilesIndex6{
        -webkit-box-align: stretch;
        align-items: stretch;
        border-width: 0px;
        border-style: solid;
        box-sizing: border-box;
        display: flex;
        flex-basis: auto;
        flex-direction: column;
        flex-shrink: 0;
        outline: none;
        min-height: 0px;
        min-width: 0px;
        position: relative;
        height: var(--scrollHeight,88px);
    }
    
    .SideBarFilesTreeItems{
        box-sizing: border-box;
        flex: 1 1 auto;
        outline: none;
        min-height: 0px;
        min-width: 0px;
        position: absolute;
        top: 0px;
        left: 0px;
        width: calc(100% - var(--rowLeftIndent,0px));
        height: var(--rowHeight,24px);
        transform: translateY(var(--rowY,8px));
        margin-left: var(--rowLeftIndent,0px);
        -webkit-box-flex: 1;
        display: flex;
        flex-direction: row;
        -webkit-box-align: center;
        align-items: center;
        transition-property: background-color, box-shadow;
        transition-timing-function: ease-out;
        border-width: 1px;
        border-style: solid;
        border-color: transparent;
        background-color: var(--nodeBackgroundColor,transparent);
        border-radius: var(--borderRadius,4px);
        cursor: pointer;
        --hasUnsavedChangesDisplay: flex;
        transition-duration: 0ms;
    }
    .SideBarFilesTreeItems:hover{
        cursor:pointer;
        background-color: #c2c8cc2e;
    }
    .SideBarFilesTreeItems1{
        border-width: 0px;
        border-style: solid;
        box-sizing: border-box;
        flex: 1 1 auto;
        outline: none;
        min-height: 0px;
        min-width: 0px;
        display: flex;
        flex-direction: row;
        -webkit-box-align: center;
        align-items: center;
        -webkit-box-flex: 1;
        padding-left: var(--horizontalPadding,4px);
        padding-right: var(--horizontalPadding,4px);
    }

    .SideBarFilesIcon{
        -webkit-box-align: stretch;
        align-items: stretch;
        border-width: 0px;
        border-style: solid;
        box-sizing: border-box;
        display: flex;
        flex-basis: auto;
        flex-direction: column;
        flex-shrink: 0;
        outline: none;
        min-height: 0px;
        min-width: 0px;
        margin-right: var(--iconTextGap,6px);
    }

    .SideBarFilesIcon img{
        min-width: var(--iconSize,16px) !important;
        min-height: var(--iconSize,16px) !important;
        width: var(--iconSize,16px) !important;
        height: var(--iconSize,16px) !important;
    }

    .SideBarFilesName{
        -webkit-box-align: stretch;
        align-items: stretch;
        border-width: 0px;
        border-style: solid;
        box-sizing: border-box;
        flex: 1 1 auto;
        flex-direction: column;
        outline: none;
        min-height: 0px;
        min-width: 0px;
        display: inline-block;
        max-width: 100%;
        overflow: hidden;
        text-overflow: ellipsis;
        white-space: nowrap;
        font-size: var(--fontSize,13px);
        -webkit-box-flex: 1;
        color: var(--statusColor,#C2C8CC);
    }

    .SideBarFilesMenuButton{
        box-sizing: border-box;
        flex-basis: auto;
        flex-direction: column;
        flex-shrink: 0;
        outline: none;
        min-height: 0px;
        min-width: 0px;
        border: 1px solid transparent;
        background: transparent;
        color: inherit;
        font-style: inherit;
        font-variant: inherit;
        font-weight: inherit;
        font-stretch: inherit;
        font-size: inherit;
        font-family: inherit;
        font-optical-sizing: inherit;
        font-size-adjust: inherit;
        font-kerning: inherit;
        font-feature-settings: inherit;
        font-variation-settings: inherit;
        line-height: normal;
        app-region: no-drag;
        user-select: none;
        height: 100%;
        -webkit-box-align: center;
        align-items: center;
        -webkit-box-pack: center;
        justify-content: center;
        cursor: pointer;
        transition-property: background-color, box-shadow;
        transition-timing-function: ease-out;
        display: var(--contextMenuButtonDisplay,none);
        border-radius: 0 var(--borderRadius,4px) var(--borderRadius,4px) 0;
        transition-duration: 0ms;
    }

    .SideBarFilesHistoryDivider1{
        -webkit-box-align: stretch;
        align-items: stretch;
        border-width: 0px;
        border-style: solid;
        box-sizing: border-box;
        display: flex;
        flex-basis: auto;
        flex-direction: column;
        flex-shrink: 0;
        outline: none;
        min-height: 0px;
        min-width: 0px;
        position: relative;
        height: 0px;
        width: 100%;
        z-index: 1;
        cursor: ns-resize;
    }
    
    .SideBarFilesHistoryDivider2{
        -webkit-box-align: stretch;
        align-items: stretch;
        border-width: 0px;
        border-style: solid;
        box-sizing: border-box;
        display: flex;
        flex-basis: auto;
        flex-direction: column;
        flex-shrink: 0;
        outline: none;
        min-height: 0px;
        min-width: 0px;
        position: relative;
        height: 8px;
        top: -4px;
    }
/******************************** SideBar ***************************/

    /*Divider*/
    .divider{
        border-width:0px;
        border-style:solid;
        box-sizing:border-box;
        display:flex;
        flex-basis:auto;
        flex-direction:auto;
        flex-shrink: 0;
        outline:none;
        -webkit-box-align:center;
        align-items: center;
        -webkit-box-pack:center;
        justify-content: center;
        position:absolute;
        top:0px;
        left:0px;
        opacity:1;
        transition:opacity 0.2s 200ms;
        transform:translate(var(--transformX,0px), var(--transformY,0px));
        width:var(--width);
        height:var(--height);
        cursor:var(--cursor);
        background-color:var(--background-color);
    }
    .divider:hover{
        --gripColor:#e2d8d87f;
    }
    .blanket{
        -webkit-box-align: stretch;
        align-items: stretch;
        border-width:0px;
        border-style:solid;
        box-sizing:border-box;
        display: flex;
        flex-basis:auto;
        flex-direction: column;
        flex-shrink: 0;
        outline:none;
        min-height:0px;
        min-width:0px;
        position:absolute;
        top:0px;
        left:0px;
        width:100%;
        height:100%;
    }

    .grip{
        -webkit-box-align: stretch;
        align-items: stretch;
        border-width:0px;
        border-style:solid;
        box-sizing:border-box;
        display: flex;
        flex-basis:auto;
        flex-direction: column;
        flex-shrink: 0;
        outline:none;
        min-height:0px;
        min-width:0px;
        border-radius:4px;
        visibility:var(--gripVisibility);
        background:var(--gripColor,#2B3245);
        height:var(--gripHeight);
        width: var(--gripWidth);
        transition-property: opacity, width, height, background-color;
        transition-timing-function:ease-out;
    }
    main{
        display:block;
    }

    .MainContainer {
        animation:0.2s ease-in-out 0s 1 normal none;
        transition:opacity 0.2s 200ms;
    }

</style>
</body>
</html>
