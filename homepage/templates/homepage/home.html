{% extends 'homepage/layout.html' %}

{% block title %}Home{% endblock %}

{% block content %}

    <div class="container mt-5">
        <div class="mb-4">
            <div>
                <button class="btn btn-primary" onclick="toggleForm()">Create Project</button>
            </div>
            <div id="formContainer" class="form-container" style="display:none;">
                <form id="projectForm" method="post">
                    {% csrf_token %}
                    <div class="form-row">
                        <div class="col-md-6">
                            <div class="form-group">
                                <label for="id_title">Title</label>
                                {{ form.title }}
                            </div>
                            <div class="form-group">
                                <label for="id_language">Language</label>
                                <div class="language-selector">
                                    <div role="combobox" aria-haspopup="listbox">
                                        <div class="combobox-wrapper">
                                            <div class="input-wrapper">
                                                <input type="text" id="language-input" placeholder="Search Languages" class="form-control">
                                            </div>
                                            <div class="toggle-button-wrapper">
                                                <button id="language-toggle-button" type="button" class="toggle-button" onclick="toggleDropdown()">
                                                    <i class="fas fa-search"></i>
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                    <div id="language-menu" role="listbox" class="dropdown-menu" style="display: none;">
                                        <!-- Options will be populated here by JavaScript -->
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="form-group">
                                <label for="id_description">Description</label>
                                {{ form.description }}
                            </div>
                            <button type="submit" class="btn btn-primary mt-2">Create</button>
                        </div>
                    </div>
                </form>
            </div>  
            <div class="box-border">
                <div class="d-flex justify-content-between align-items-center">
                    <h2>Recent Projects</h2>
                </div>
                <ul>
                    {% for project in projects %}
                    <li>
                        {{ project.title }} by {{ project.user.username }} (Last modified: {{ project.last_modified }})
                    </li>
                    {% endfor %}
                </ul>
            </div>
        </div>
    </div>

    <script>
        function toggleForm() {
            var formContainer = document.getElementById('formContainer');
            if (formContainer.style.display === 'none') {
                formContainer.style.display = 'block';
                document.addEventListener('click', handleClickOutside);
            } else {
                hideForm();
            }
        }

        function handleClickOutside(event) {
            var formContainer = document.getElementById('formContainer');
            if (!formContainer.contains(event.target) && !event.target.matches('.btn-primary')) {
                hideForm();
            }
        }

        function hideForm() {
            var formContainer = document.getElementById('formContainer');
            var projectForm = document.getElementById('projectForm');
            formContainer.style.display = 'none';
            projectForm.reset();
            document.removeEventListener('click', handleClickOutside);
        }

        function toggleDropdown() {
            var languageMenu = document.getElementById('language-menu');
            if (languageMenu.style.display === 'none') {
                languageMenu.style.display = 'block';
            } else {
                languageMenu.style.display = 'none';
            }
        }

        document.addEventListener('DOMContentLoaded', function() {
            var languageSelect = document.querySelector('.language-select select');
            var languageMenu = document.getElementById('language-menu');
            
            // Populate the dropdown menu
            for (var i = 0; i < languageSelect.options.length; i++) {
                var option = languageSelect.options[i];
                var item = document.createElement('div');
                item.setAttribute('role', 'option');
                item.setAttribute('data-value', option.value);
                item.textContent = option.text;
                item.classList.add('dropdown-item');
                item.addEventListener('click', function(event) {
                    document.getElementById('language-input').value = event.target.textContent;
                    languageSelect.value = event.target.getAttribute('data-value');
                    languageMenu.style.display = 'none';
                });
                languageMenu.appendChild(item);
            }

            // Hide the native select
            languageSelect.style.display = 'none';
        });
    </script>

<style>
    .form-container {
        border: 1px solid #ccc;
        padding: 20px;
        background-color: #f9f9f9;
        width: 100%;
        max-width: 600px;
        box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        z-index: 1000;
    }

    .form-row {
        display: flex;
        flex-wrap: wrap;
        justify-content: space-between;
    }

    .form-group {
        display: flex;
        flex-direction: column;
        margin-bottom: 1rem;
    }

    .form-group label {
        margin-bottom: 0.5rem;
    }

    .form-control {
        width: 100%;
    }

    .col-md-6 {
        flex: 0 0 48%;
    }

    .btn-primary {
        margin-top: 1rem;
    }

    .language-selector {
        position: relative;
    }

    .combobox-wrapper {
        display: flex;
        align-items: center;
    }

    .input-wrapper {
        flex-grow: 1;
    }

    .toggle-button-wrapper {
        display: flex;
        align-items: center;
    }

    .toggle-button {
        background: none;
        border: none;
        cursor: pointer;
    }

    .dropdown-menu {
        position: absolute;
        top: 100%;
        left: 0;
        right: 0;
        max-height: 200px;
        overflow-y: auto;
        background-color: #fff;
        border: 1px solid #ccc;
        z-index: 1000;
    }

    .dropdown-item {
        padding: 8px;
        cursor: pointer;
    }

    .dropdown-item:hover {
        background-color: #f0f0f0;
    }
</style>
{% endblock %}
